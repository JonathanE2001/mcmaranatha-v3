<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, push } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const firebaseConfig = { 
  apiKey : "AIzaSyA--6-0cX6qPdUwV0NllkgtAhpm2_SDdJ4" , 
  authDomain : "mcmaranatha-9b500.firebaseapp.com" , 
  databaseURL : "https://mcmaranatha-9b500-default-rtdb.europe-west1.firebasedatabase.app" , 
  projectId : "mcmaranatha-9b500" , 
  storageBucket : "mcmaranatha-9b500.firebasestorage.app" , 
  messagingSenderId : "305909078179" , 
  appId : "1:305909078179:web:165a92a8abb81ccb0a4716" 
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let gekozenBurger = null;
let gekozenSauzen = [];
let gekozenSide = null;

const menu = [
  {
    naam: "Vega Burger",
    beschrijving: "Bun, Sla, Ui, Tomaat, Komkommer, Vega Burger, Rucola, Bun"
  },
  {
    naam: "Basic Burger / BB",
    beschrijving: "Mosterd, Gebakken uitjes, Kaas, Hamburger, Augurk, Tomaat, Sla, Mayo"
  },
  {
    naam: "Diet Big Mac",
    beschrijving: "Bun, saus, sla, hamburger, kaas, saus, sla, hamburger, kaas, augurk, bun"
  },
  {
    naam: "Big Marco",
    beschrijving: "Augurk, Big Mac saus, sla, ui, cheddar, burger"
  },
  {
    naam: "Fire of the Spirit Burger",
    beschrijving: "Bun gebakken in chili olie, burger, jalapeÃ±o, sriracha saus, gebakken knoflook, gefrituurde ui"
  },
  {
    naam: "El Sylvano Grande",
    beschrijving: "Saus, Burger, Kaas, Augurk, Saus, Sla, Tomaat, Burger, Kaas"
  },
  {
    naam: "Alfa Omega Burger",
    beschrijving: "Kaas, Sla, Burger, Sla, Augurk, Burger, Kaas"
  },
  {
    naam: "Power of the Nuggies Tower",
    beschrijving: "Veel nuggets, patat, meer nuggets"
  },
  {
    naam: "CCC (Christian Crispy Chicken)",
    beschrijving: "Saus (naar keuze), Kaas, Kipburger, Kaas, Kipburger, Crispy Ui, Sla, Saus (naar keuze)",
    ccc: true
  },
  {
    naam: "McMinion",
    beschrijving: "Pita broodje met gloeiworm (serieus lekker)"
  }
];

const menuContainer = document.getElementById("menu");

menu.forEach(burger => {
  const div = document.createElement("div");
  div.innerHTML = `
    <h3>${burger.naam}</h3>
    <p>${burger.beschrijving}</p>
    <button>Bestel</button>
    <hr>
  `;
  div.querySelector("button").onclick = () => startBestelling(burger);
  menuContainer.appendChild(div);
});

function startBestelling(burger) {
  gekozenBurger = burger;
  gekozenSauzen = [];
  gekozenSide = null;

  if (burger.ccc) {
    toonSausKeuze();
  } else {
    toonSideKeuze();
  }
}

function toonSausKeuze() {
  const popup = document.createElement("div");
  popup.innerHTML = `
    <h2>Kies max 3 sauzen</h2>
    <form id="sausForm">
      <label><input type="checkbox" value="Mayo"> Mayo</label><br>
      <label><input type="checkbox" value="Ketchup"> Ketchup</label><br>
      <label><input type="checkbox" value="Curry"> Curry</label><br>
      <label><input type="checkbox" value="Knoflooksaus"> Knoflooksaus</label><br>
      <label><input type="checkbox" value="Sriracha"> Sriracha</label><br><br>
      <button type="submit">Verder</button>
    </form>
  `;
  document.body.appendChild(popup);

  document.getElementById("sausForm").onsubmit = function(e) {
    e.preventDefault();
    const checked = [...this.querySelectorAll("input:checked")];

    if (checked.length > 3) {
      alert("Maximaal 3 sauzen kiezen");
      return;
    }

    gekozenSauzen = checked.map(c => c.value);
    popup.remove();
    toonSideKeuze();
  };
}

function toonSideKeuze() {
  const popup = document.createElement("div");
  popup.innerHTML = `
    <h2>Wil je er iets bij?</h2>
    <button onclick="kiesSide('Geen')">Nee</button>
    <button onclick="kiesSide('Aardappelkroketjes')">Aardappelkroketjes</button>
    <button onclick="kiesSide('Kipnuggets')">Kipnuggets</button>
  `;
  document.body.appendChild(popup);
}

window.kiesSide = function(side) {
  gekozenSide = side;
  document.querySelectorAll("div").forEach(d => {
    if (d.innerHTML.includes("Wil je er iets bij?")) d.remove();
  });
  vraagNaam();
}

function vraagNaam() {
  const naam = prompt("Vul je naam in:");
  if (!naam || naam.trim() === "") {
    alert("Naam is verplicht");
    return vraagNaam();
  }

  bestellingOpslaan(naam.trim());
}

function bestellingOpslaan(naam) {
  push(ref(db, "bestellingen"), {
    naam: naam,
    burger: gekozenBurger.naam,
    beschrijving: gekozenBurger.beschrijving,
    sauzen: gekozenSauzen,
    side: gekozenSide,
    tijd: Date.now()
  });

  alert("Bestelling geplaatst!");
}
</script>
